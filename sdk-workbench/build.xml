<?xml version="1.0" encoding="utf-8" ?>
<project name="caCORE Workbench - Packaging" default="package" basedir="." xmlns:ivy="antlib:org.apache.ivy.ant" xmlns:cs="antlib:com.puppycrawl.tools.checkstyle">
	<description>
	</description>

	<property name="output.dir" value="dist"/>
	<property name="temp.dir" value="${output.dir}/temp"/>
	<property name="docs.temp.dir" value="${temp.dir}/docs"/>
	<property name="workbench.base.dir" value="."/>
	<property name="workbench.dir" value="workbench-project"/>
	<property name="software.dir" value="${workbench.dir}/software"/>
	<property name="build.dir" value="${software.dir}/build"/>
	<property name="modules.dir" value="${software.dir}/modules"/>
	
	<property file="${build.dir}/project.properties"/>
	
	<property name="workbench.src.file" value="Workbench-${workbench.version}-src.zip"/>

	<target name="init">
		<mkdir dir="${output.dir}"/>
		<mkdir dir="${temp.dir}"/>
	</target>

	<target name="clean" description="cleans the dist folder">
		<delete dir="${temp.dir}"/>
	</target>

	<target name="package" depends="clean,init,-systemdocs,-package:sdk:src,-package-software">
	</target>
	
	<target name="-package:sdk:src" description="Packages the SDK Toolkit for inclusion with the Workbench">
		<ant antfile="build.xml" target="package:sdk:src" dir="workbench-project/software/build" inheritall="false" inheritrefs="false">
		</ant>
	</target>

	<!--***********************************************************************
	*** Generates Javadocs for the entire system
	*********************************************************************** -->
	<target name="-systemdocs" description="Generates javadocs for the entire system">
		<javadoc packagenames="*" destdir="${docs.temp.dir}" author="true"
			private="true" version="true" use="true" windowtitle="caCORE Workbench ${workbench.version} API Documentation"
			doctitle="caCORE Workbench ${workbench.version} API Documentation" useexternalfile="false" verbose="false">
		    <bottom><![CDATA[<i>This System API was generated by the <a href='http://cabig.nci.nih.gov/tools/caCOREWorkbench'>caCORE Workbench</a>.</i>]]></bottom>
			<fileset dir="${modules.dir}" includes="**/*.java"/>
		</javadoc>
		<delete file="${output.dir}/Workbench-${workbench.version}-JavaDocs.zip" failonerror="false"/>
		<zip destfile="${output.dir}/Workbench-${workbench.version}-JavaDocs.zip" whenempty="skip">
			<zipfileset dir="${docs.temp.dir}"/>
		</zip>
		<delete dir="${temp.dir}" failonerror="false"/>
	</target>

	<target name="-package-software" description="Packages the entire system">
		<delete file="${output.dir}/${workbench.src.file}" failonerror="false"/>
		<zip destfile="${output.dir}/${workbench.src.file}" whenempty="skip">
			<zipfileset dir="${workbench.base.dir}">
				<exclude name="**/bin/**"/>
				<exclude name="**/target/**"/>
				<exclude name="docs/**"/>
				<exclude name="tools/**"/>
				<exclude name="**/bda-local-ivy-repo/**"/>
				<exclude name="**/local-ivy-repo/**"/>
				<exclude name="**/dist/**"/>
				<exclude name=".project"/>
				<exclude name=".classpath"/>
				<exclude name="build.xml"/>
			</zipfileset>
		</zip>
	</target>

</project>
