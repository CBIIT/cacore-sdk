<?xml version="1.0" encoding="UTF-8"?>
<project name="caCore SDK - Test Scripts" basedir="." default="defaultTest">

	<description>Build script for caCORE SDK Generator Hudson Tests</description>

	<property name="project.home" location="${basedir}/.." />
	<property name="project.target.dir" value="${project.home}/target" />
	<property name="dist.dir" value="${project.target.dir}/dist"/>
	<property name="dist.exploded.dir" value="${dist.dir}/exploded"/>

	<macrodef name="run-test">

		<attribute name="SERVER.TYPE" default="tomcat" />
		<attribute name="MODEL.FILE.TYPE" default="EA" />

		<attribute name="DB.TYPE" default="oracle" />
		<attribute name="DB.USE.JNDI.BASED.CONNECTION" default="false" />

		<attribute name="ENABLE.WRITABLE.API.EXTENSION" default="false" />
		<attribute name="ENABLE.COMMON.LOGGING.MODULE" default="false" />

		<attribute name="ENABLE.SECURITY" default="false" />
		<attribute name="ENABLE.GRID.LOGIN.MODULE" default="false" />
		<attribute name="ENABLE.CSM.LOGIN.MODULE" default="false" />
		<attribute name="ENABLE.INSTANCE.LEVEL.SECURITY" default="false" />
		<attribute name="ENABLE.ATTRIBUTE.LEVEL.SECURITY" default="false" />
		<attribute name="CACHE.PROTECTION.ELEMENTS" default="false" />
		<attribute name="CSM.USE.JNDI.BASED.CONNECTION" default="false" />

		<attribute name="GENERATE.XSD.WITH.GME.TAGS" default="false" />
		<attribute name="GENERATE.XSD.WITH.PERMISSIBLE.VALUE" default="false" />
		<attribute name="GENERATE.HIBERNATE.VALIDATOR" default="false" />

		<sequential>
			<property name="SERVER_TYPE" value="@{SERVER.TYPE}" />
			<property name="MODEL_FILE_TYPE" value="@{MODEL.FILE.TYPE}" />

			<property name="DB_TYPE" value="@{DB.TYPE}" />
			<property name="DB_USE_JNDI_BASED_CONNECTION" value="@{DB.USE.JNDI.BASED.CONNECTION}" />

			<property name="ENABLE_WRITABLE_API_EXTENSION" value="@{ENABLE.WRITABLE.API.EXTENSION}" />
			<property name="ENABLE_COMMON_LOGGING_MODULE" value="@{ENABLE.COMMON.LOGGING.MODULE}" />

			<property name="ENABLE_SECURITY" value="@{ENABLE.SECURITY}" />
			<property name="ENABLE_GRID_LOGIN_MODULE" value="@{ENABLE.GRID.LOGIN.MODULE}" />
			<property name="ENABLE_CSM_LOGIN_MODULE" value="@{ENABLE.CSM.LOGIN.MODULE}" />
			<property name="ENABLE_INSTANCE_LEVEL_SECURITY" value="@{ENABLE.INSTANCE.LEVEL.SECURITY}" />
			<property name="ENABLE_property_LEVEL_SECURITY" value="@{ENABLE.property.LEVEL.SECURITY}" />
			<property name="CACHE_PROTECTION_ELEMENTS" value="@{CACHE.PROTECTION.ELEMENTS}" />
			<property name="CSM_USE_JNDI_BASED_CONNECTION" value="@{CSM.USE.JNDI.BASED.CONNECTION}" />

			<property name="GENERATE_XSD_WITH_GME_TAGS" value="@{GENERATE.XSD.WITH.GME.TAGS}" />
			<property name="GENERATE_XSD_WITH_PERMISSIBLE_VALUE" value="@{GENERATE.XSD.WITH.PERMISSIBLE.VALUE}" />
			<property name="GENERATE_HIBERNATE_VALIDATOR" value="@{GENERATE.HIBERNATE.VALIDATOR}" />

			<ant antfile="build.xml" dir="." target="dist" inheritAll="true">
			</ant>

			<copy todir="${dist.exploded.dir}" overwrite="true">
				<fileset dir="." includes="*.properties" />
			</copy>
			<ant antfile="build.xml" dir="${dist.exploded.dir}" target="install" inheritAll="true">
				<property name="bda-utils.dir" value="${dist.exploded.dir}/bda-utils" />
			</ant>

		</sequential>
	</macrodef>

	<target name="defaultTest">
		<run-test />
	</target>

	<target name="build2Test">
		<run-test ENABLE.WRITABLE.API.EXTENSION="true" GENERATE.XSD.WITH.GME.TAGS="true" />
		
	</target>

	<target name="build3Test">
		<run-test MODEL.FILE.TYPE="ARGO" DB.USE.JNDI.BASED.CONNECTION="true" ENABLE.COMMON.LOGGING.MODULE="true" ENABLE.WRITABLE.API.EXTENSION="true" />
	</target>

	<target name="build4Test">
		<run-test DB.USE.JNDI.BASED.CONNECTION="true" ENABLE.SECURITY="true" ENABLE.CSM.LOGIN.MODULE="true" GENERATE.XSD.WITH.PERMISSIBLE.VALUE="true" />
	</target>

	<target name="build5Test">
		<run-test ENABLE.SECURITY="true" CACHE.PROTECTION.ELEMENTS="true" ENABLE.CSM.LOGIN.MODULE="true" CSM.USE.JNDI.BASED.CONNECTION="true" />
	</target>

	<target name="build6Test">
		<run-test ENABLE.SECURITY="true" ENABLE.CSM.LOGIN.MODULE="true" ENABLE.INSTANCE.LEVEL.SECURITY="true" GENERATE.XSD.WITH.GME.TAGS="true" GENERATE.XSD.WITH.PERMISSIBLE.VALUE="true" />
	</target>

	<target name="build7Test">
		<run-test ENABLE.SECURITY="true" ENABLE.CSM.LOGIN.MODULE="true" ENABLE.ATTRIBUTE.LEVEL.SECURITY="true" />
	</target>

	<target name="build8Test">
		<run-test ENABLE.SECURITY="true" CACHE.PROTECTION.ELEMENTS="true" ENABLE.CSM.LOGIN.MODULE="true" ENABLE.INSTANCE.LEVEL.SECURITY="true" ENABLE.ATTRIBUTE.LEVEL.SECURITY="true" />
	</target>

	<target name="build9Test">
		<run-test SERVER.TYPE="mysql" ENABLE.WRITABLE.API.EXTENSION="true" ENABLE.SECURITY="true" ENABLE.CSM.LOGIN.MODULE="true" />
	</target>

	<target name="build10Test">
		<run-test ENABLE.WRITABLE.API.EXTENSION="true" ENABLE.COMMON.LOGGING.MODULE="true" ENABLE.SECURITY="true" ENABLE.CSM.LOGIN.MODULE="true" ENABLE.ATTRIBUTE.LEVEL.SECURITY="true" />
	</target>

	<target name="build11Test">
		<run-test ENABLE.SECURITY="true" ENABLE.GRID.LOGIN.MODULE="true" />
	</target>

	<target name="build12Test">
		<run-test ENABLE.SECURITY="true" CACHE.PROTECTION.ELEMENTS="true" ENABLE.GRID.LOGIN.MODULE="true" ENABLE.CSM.LOGIN.MODULE="true" ENABLE.INSTANCE.LEVEL.SECURITY="true" />
	</target>

	<target name="build13Test">
		<run-test SERVER.TYPE="jboss" DB.TYPE="mysql" />
	</target>

	<target name="build14Test">
		<run-test SERVER.TYPE="jboss" DB.TYPE="mysql" MODEL.FILE.TYPE="ARGO" ENABLE.WRITABLE.API.EXTENSION="true" ENABLE.COMMON.LOGGING.MODULE="true" GENERATE.HIBERNATE.VALIDATOR="true" />
	</target>

	<target name="build15Test">
		<run-test SERVER.TYPE="jboss" DB.USE.JNDI.BASED.CONNECTION="true" ENABLE.SECURITY="true" ENABLE.CSM.LOGIN.MODULE="true" CSM.USE.JNDI.BASED.CONNECTION="true" />
	</target>

	<target name="build16Test">
		<run-test SERVER.TYPE="jboss" ENABLE.SECURITY="true" ENABLE.GRID.LOGIN.MODULE="true" />
	</target>
	
</project>